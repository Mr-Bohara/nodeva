<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://nepalidatetimepicker.com/cdn/dist/nepali.datepicker.v4.0.1.min.css" rel="stylesheet"
        type="text/css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>

    <!-- Notification Container -->
    <div id="notification-area"></div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="overlay active">
        <div class="login-card">
            <h1>Welcome Back</h1>
            <p>Please sign in to access your expenses.</p>
            <div id="g_id_onload"
                data-client_id="801807520407-3ga0umae1de735nldq5t5n8bge87o6c2.apps.googleusercontent.com"
                data-callback="handleCredentialResponse" data-auto_select="true" data-itp_support="true">
            </div>
            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
            </div>
            <p class="crypto-note">Protected by Google OAuth</p>

        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard hidden">
        <header>
            <div class="logo">ExpenseTracker</div>
            <div class="user-profile">
                <span id="user-email">user@example.com</span>
                <button id="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" onclick="switchTab('shop')">Pasal Kharcha</button>
            <button class="tab-btn" onclick="switchTab('rent')">Kotha Vada</button>
            <button class="tab-btn" onclick="switchTab('college')">College Fee</button>
            <button class="tab-btn" onclick="switchTab('personal')">Personal</button>
            <button class="tab-btn" onclick="switchTab('todo')">To-Do List</button>
            <button class="tab-btn" onclick="switchTab('history')">History</button>
        </nav>


        <main>
            <!-- Shop Expenses -->
            <section id="shop" class="tab-content active">
                <h2>Pasal Kharcha</h2>
                <form id="form-shop" onsubmit="submitForm(event, 'Pasal Kharcha')">
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" name="item_name" required placeholder="e.g. Rice, Oil">
                    </div>
                    <div class="form-group">
                        <label>Price (रू.)</label>
                        <input type="number" name="price" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Date & Time</label>
                        <input type="datetime-local" name="date_time" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Expense</button>
                </form>
            </section>

            <!-- Room Rent -->
            <section id="rent" class="tab-content">
                <h2>Kotha Vada</h2>
                <form id="form-rent" onsubmit="submitForm(event, 'Kotha Vada')">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="date" required>
                    </div>
                    <div class="form-group">
                        <label>Price (रू.)</label>
                        <input type="number" name="price" required placeholder="0.00">
                    </div>
                    <button type="submit" class="submit-btn">Add Rent</button>
                </form>
            </section>

            <!-- College Fee -->
            <section id="college" class="tab-content">
                <h2>College Fee</h2>
                <form id="form-college" onsubmit="submitForm(event, 'College Fee')">
                    <div class="form-group">
                        <label>Semester</label>
                        <select name="semester" required>
                            <option value="1">1st Semester</option>
                            <option value="2">2nd Semester</option>
                            <option value="3">3rd Semester</option>
                            <option value="4">4th Semester</option>
                            <option value="5">5th Semester</option>
                            <option value="6">6th Semester</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" required placeholder="e.g. Exam Fee, Tuition">
                    </div>
                    <div class="form-group">
                        <label>Price (रू.)</label>
                        <input type="number" name="price" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="date" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Fee</button>
                </form>
            </section>

            <!-- Personal Expenses -->
            <section id="personal" class="tab-content">
                <h2>Personal Kharcha</h2>
                <form id="form-personal" onsubmit="submitForm(event, 'Personal Kharcha')">
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" required placeholder="e.g. Food, Travel">
                    </div>
                    <div class="form-group">
                        <label>Price (रू.)</label>
                        <input type="number" name="price" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="date" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Expense</button>
                </form>
            </section>
            <!-- To-Do List -->
            <section id="todo" class="tab-content">
                <div class="todo-header">
                    <div class="todo-title-container">
                        <svg viewBox="0 0 500 150" class="todo-title-svg">
                            <path d="M50,80 Q250,20 450,80" fill="none" stroke="black" stroke-width="4" />
                            <text x="50%" y="75" text-anchor="middle" class="handwritten-title">to do list</text>
                            <text x="40" y="40" class="todo-flower">✿</text>
                            <text x="460" y="110" class="todo-flower">✿</text>
                        </svg>
                    </div>
                    <div class="todo-stats">
                        <div class="stat-item incomplete">Incomplete: <span id="incomplete-count">0</span></div>
                        <div class="stat-item complete">Completed: <span id="complete-count">0</span></div>
                    </div>
                </div>

                <form id="todo-form" onsubmit="addTodo(event)" class="todo-form">
                    <div class="todo-input-group">
                        <input type="text" id="todo-input" required placeholder="Tape your task here...">
                        <button type="submit" class="todo-add-btn">+</button>
                    </div>
                </form>

                <div id="todo-list" class="todo-list">
                    <!-- Tasks will appear here -->
                    <div class="loading-text">Loading tasks...</div>
                </div>
            </section>


            <!-- History -->
            <section id="history" class="tab-content">
                <div class="summary-cards history-summary">
                    <div class="summary-card">
                        <h3>This Week</h3>
                        <p id="history-weekly-total">Calculating...</p>
                        <div class="card-doodle">~~~~</div>
                    </div>
                    <div class="summary-card">
                        <h3>This Month</h3>
                        <p id="history-monthly-total">Calculating...</p>
                        <div class="card-doodle">~~~~</div>
                    </div>
                    <div class="summary-card">
                        <h3>This Year</h3>
                        <p id="history-yearly-total">Calculating...</p>
                        <div class="card-doodle">~~~~</div>
                    </div>
                </div>

                <div
                    style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <h2>Recent Expenses</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="history-filter" onchange="applyHistoryFilter()"
                            style="background: #0f172a; color: white; border: 1px solid #334155; padding: 8px; border-radius: 6px;">
                            <option value="All">All Categories</option>
                            <option value="Shop">Pasal (Shop)</option>
                            <option value="Rent">Vada (Rent)</option>
                            <option value="College">College</option>
                            <option value="Personal">Personal</option>
                        </select>
                        <button class="refresh-btn" onclick="fetchHistory()"
                            style="margin: 0; padding: 8px 16px;">Refresh Table</button>
                    </div>
                </div>

                <div class="table-container" style="overflow-x: auto;">
                    <table
                        style="width: 100%; border-collapse: collapse; background: transparent; border-top: 2px solid #000;">
                        <thead>
                            <tr style="border-bottom: 2px solid #000; color: #000; text-align: left;">
                                <th style="padding: 12px; border-right: 1px solid rgba(0,0,0,0.1);">Date</th>
                                <th style="padding: 12px; border-right: 1px solid rgba(0,0,0,0.1);">Type</th>
                                <th style="padding: 12px; border-right: 1px solid rgba(0,0,0,0.1);">Item/Category</th>
                                <th style="padding: 12px; border-right: 1px solid rgba(0,0,0,0.1);">Price (रू.)</th>
                                <th style="padding: 12px;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <tr>
                                <td colspan="5" style="padding: 20px; text-align: center; color: #000;">Loading
                                    history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <script src="https://nepalidatetimepicker.com/cdn/dist/nepali.datepicker.v4.0.1.min.js"
        type="text/javascript"></script>
    <script src="app.js"></script>
</body>

</html>